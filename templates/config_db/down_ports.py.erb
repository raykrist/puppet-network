#!/usr/bin/env python

import subprocess
import json

config_file = "/etc/sonic/config_db.json"

endpoint_ports = [
<% @endpoint_ports.each do |port| -%>
  '<%= port %>',
<% end %>
]

# take down all endpoint ports with sonic cli
for port in endpoint_ports:
  subprocess.run(["config", "interface", "shutdown", port])
  #print(f'config interface shutdown {port}')

# backup current config_db.json
subprocess.run(["cp", "-f", config_file, f'{config_file}.bak-down_ports.py'])

# make sure we edit config_db.json to keep endpoint ports down after reboot
with open(config_file, 'r') as file:
  data = json.load(file)
  for port in endpoint_ports:
    data['PORT'][port]['admin_status'] = 'down'

with open(config_file, 'w') as file:
  json.dump(data, file, indent=4)
